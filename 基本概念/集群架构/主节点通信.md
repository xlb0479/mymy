# 主节点通信

本文来讲讲主节点（可以当成是apiserver吧）和k8s集群的通信链路。通过这部分的学习，用户可以强化k8s的网络环境配置，比如将集群安装在不授信的网络中（或者完全安装在云服务商的公网IP上）。

- [集群到Master](#集群到Master)
- [Master到集群](#Master到集群)

## 集群到Master

所有从集群指向Master的链路最终都会落到apiserver上（Master上的其他组件都不会暴露可远程访问的服务）。典型的部署方式是，apiserver监听HTTPS端口（443），接受远程连接，并且至少开启一种客户端[授权模式]()，特别是允许[匿名请求]()，或[服务账号令牌]()的情况。

节点这边应当使用公共根证书，这样才能用有效的客户端证书连接到apiserver上。比如在一套默认的GKE环境中，kubelet的客户端凭证就是证书的形式。关于如何自动获取kubelet的客户端证书，详见[kubelet TLS启动]()。

Pod可以用服务账户的形式安全的连接到apiserver上，当Pod实例化的时候，k8s会自动将公共根证书和一个令牌注入到Pod里。在所有命名空间中，`kubernetes`服务都配置了重定向到apiserver的HTTPS端点的虚拟IP（通过kube-proxy）。

主节点的组件也是通过安全端口跟apiserver通信。

有了这些配置，默认情况下由集群（节点和运行在节点上的Pod）指向主节点的连接就有了安全保障，可以运行在非授信或公共网络中了。