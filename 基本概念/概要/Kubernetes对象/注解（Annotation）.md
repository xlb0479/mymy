# 注解（Annotation）

可以用注解给对象增加任意的元数据，注意这些元数据不能用来标识对象（这个事儿得靠标签）。各种客户端工具都可以获取到这些元数据。

- [给对象添加元数据](#给对象添加元数据)
- [规范](#规范)
- [接下来……](#接下来)

## 给对象添加元数据

标签和注解都可以给对象添加元数据。标签可以用于筛选某类条件下的对象。但注解可不是干这个的。注解中的元数据可大可小，结构可有可无，还可以包含标签不支持的字符。

注解跟标签挺像的，也是kv映射：

```text
"metadata": {
  "annotations": {
    "key1" : "value1",
    "key2" : "value2"
  }
}
```

下面列举一些可以用注解来保存的信息：

- 由声明式配置曾所管理的字段。把这些字段加到注解上，可以跟客户端或服务器设置的默认值区分开来，以及一些自动生成或由自动伸缩系统设置的字段。（这段话，我了个去，啥？）
- 构建、版本以及镜像的信息，像是时间戳啊，版本号啊，Git分支啊，PR数量啊，镜像ID啊，镜像仓库地址啊啥的。
- 指向日志、监控、分析或审计仓库。（见识太少，不明觉厉）
- 客户端库或工具信息，可用于调试：名称、版本和构建信息。
- 用户或工具/系统的来源信息，必须一些来自其他紫铜的相关对象的URL。
- 轻量级的发布工具元数据：配置或检查点信息。
- 负责人的电话或传呼机号（我去），或者是可以找到这些信息的入口，比如团队网站地址。
- 从终端用户到实现的一些指令，来调整行为或加入非标准的特性。（啥？）

当然你也可以把这些信息存在外部数据库或者文件夹中，但是这样闹的话，对于那些用于部署、管理、自检的可共享的库和工具，就不好做了。

## 规范

*注解*是键值对。有效的key包含两部分：可选前缀和具体的名字，中间用斜线（`/`）间隔。名字是必填的，长度不超过63个字符，以字母或数字（`[a-z0-9A-Z]`）开头结尾，中间可以使用减号（`-`）、下划线（`_`）（底大杠，张全蛋）和点儿（`.`），以及其他字母或数字。前缀是可选的。如果加了，前缀必须要满足DNS子域名的规则：由一系列DNS标签组成，点（`.`）间隔，总长度不超过253个字符，以斜线（`/`）结尾。

如果没加前缀，那这个key就被认为是用户私有的。为终端用户提供注解的自动化系统组件（比如`kube-scheduler`、`kube-controller-manager`、`kube-apiserver`、`kubectl`以及其他第三方自动化程序），必须要设置前缀。

`kubernetes.io/`和`k8s.io/`这两个前缀是为k8s核心组件保留的。

下面这个Pod有一个`imageregistry: https://hub.docker.com/`注解：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: annotations-demo
  annotations:
    imageregistry: "https://hub.docker.com/"
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
```

## 接下来……

看看[标签和选择器](标签（Label）和选择器（Selector）.md)。