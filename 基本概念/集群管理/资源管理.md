# 资源管理

你部署了你的应用，然后用Service将它们暴露出来。然后呢？k8s提供了很多工具帮你来管理你的应用部署，包括扩容和更新。我们在此要深入讨论的是[配置文件](../配置/配置的最佳实践.md)和[标签](../概要/Kubernetes对象/标签（Label）和选择器（Selector）.md)。

## 管理资源配置

很多应用都需要创建多个资源，比如一个Deployment和一个Service。管理多个资源的简单方法就是将它们做到一个文件中（用YAML的`---`进行分割）。比如：

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-nginx-svc
  labels:
    app: nginx
spec:
  type: LoadBalancer
  ports:
  - port: 80
  selector:
    app: nginx
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```

多个资源可以像单个资源那样进行创建：

```shell script
kubectl apply -f https://k8s.io/examples/application/nginx-app.yaml
```

```text
service/my-nginx-svc created
deployment.apps/my-nginx created
```

资源按照它们在文件中出现的顺序进行创建。因此，最好是先定义Service，这样在控制器（比如Deployment）创建Pod的时候能够将它们分散到不同的节点（有这个规则吗？不太清楚了。）。

`kubectl apply`可以指定多个`-f`参数：

```shell script
kubectl apply -f https://k8s.io/examples/application/nginx/nginx-svc.yaml -f https://k8s.io/examples/application/nginx/nginx-deployment.yaml
```

除了一个一个指定文件，还可以指定一个文件：

```shell script
kubectl apply -f https://k8s.io/examples/application/nginx/
```

`kubectl`会读取所有后缀为`.yaml`、`.yml`以及`.json`的文件。

建议将同一个微服务或应用的相关资源都放到一个文件中，然后把所有相关的文件组织到同一个文件夹中。如果你的应用之间是通过DNS来关联的，那你可以直接一把梭，将所有组件一次性部署。

同样还可以用URL作为配置来源，便于部署那些存放在github上的配置文件。

```shell script
kubectl apply -f https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/application/nginx/nginx-deployment.yaml
```

```text
deployment.apps/my-nginx created
```

## 高效使用标签